import sys
import yara

def yara_out (file):

    rules = yara.compile('rules.yara')
    matches=rules.match(file)
    return matches

def percentage_print(total,cpp,nim,go,cs,py,java):

    perc = total/100
    cpp_perc = int(cpp/perc)
    nim_perc = int(nim/perc)
    go_perc = int(go/perc)
    cs_perc = int(cs/perc)
    py_perc = int(py/perc)
    java_perc = int(java/perc)

    print(f'[+] cpp = {cpp_perc}%')
    print(f'[+] nim = {nim_perc}%')
    print(f'[+] go = {go_perc}%')
    print(f'[+] cs = {cs_perc}%')
    print(f'[+] py = {py_perc}%')
    print(f'[+] java = {java_perc}%')

file = sys.argv[1]
result = yara_out(file)
string_res = result[0].strings
total_count = cpp_count = nim_count = go_count = cs_count = py_count = java_count = 0

for n in string_res:
    if n[1].partition('_')[0] == '$cpp':
        cpp_count+=1
    if n[1].partition('_')[0] == '$nim':
        nim_count+=1
    if n[1].partition('_')[0] == '$go':
        go_count+=1
    if n[1].partition('_')[0] == '$cs':
        cs_count+=1
    if n[1].partition('_')[0] == '$py':
        py_count+=1
    if n[1].partition('_')[0] == '$java':
        java_count+=1
    total_count+=1

percentage_print(total_count,cpp_count,nim_count,go_count,cs_count,py_count,java_count)
